# INDY - Test technique

> âš™ï¸ [Promococde API documentation](README.MD)

## **Contexte**

Tu fais partie d'une entreprise de rÃ©servation de VTC (de type Uber) et l'Ã©quipe Marketing souhaite encourager les clients Ã  rÃ©server un trajet en leur proposant des promotions.

Pour cela, elle souhaite s'Ã©quiper d'un service de gestion de _promocodes_ oÃ¹ :

- l'Ã©quipe Marketing pourra ajouter des _promocodes_ dont la validitÃ© dÃ©pendra d'un ou plusieurs critÃ¨res
- l'application pourra vÃ©rifier la validitÃ© d'un _promocode_ et obtenir la rÃ©duction associÃ©e.

> ğŸ¯ L'objectif de cet exercice est de construire ce service avec son API.

> â„¹ï¸ Tu peux t'aider de n'importe quels framework, librairie ou outil que tu juges utiles.

> â„¹ï¸ Il nâ€™y a pas de frontend Ã  dÃ©velopper.

## **SpÃ©cifications**

### **Structure d'un** _promocode_

Un promocode est composÃ© de :

- Un nom
- Un avantage (la rÃ©duction associÃ©e)
- Une ou plusieurs restrictions (les critÃ¨res de validitÃ© du promocode)

Pour qu'un promocode soit validÃ©, il faut que toutes ses restrictions soient validÃ©es.

Les restrictions sont dÃ©finies par diffÃ©rentes rÃ¨gles :

- `age`
- `date`
- `meteo`
- `or`
- `and`

Les rÃ¨gles `or` et `and` incluent d'autres rÃ¨gles.

â„¹ï¸ Une rÃ¨gle `or` ou `and` pouvant inclure d'autres rÃ¨gles `or` ou `and`, **l'arbre des restrictions peut aller jusqu'Ã  une profondeur arbitraire**.

Voici un exemple de promocode :

```json
{
  "name": "WeatherCode",
  "advantage": { "percent": 20 },
  "restrictions": [
    {
      "date": {
        "after": "2019-01-01",
        "before": "2020-06-30"
      }
    },
    {
      "or": [
        {
          "age": {
            "eq": 40
          }
        },
        {
          "and": [
            {
              "age": {
                "lt": 30,
                "gt": 15
              }
            },
            {
              "weather": {
                "is": "clear",
                "temp": {
                  "gt": 15 // Celsius here.
                }
              }
            }
          ]
        }
      ]
    }
  ]
}
```

Ce promocode se lit de la maniÃ¨re suivante :

- Il peut Ãªtre utilisÃ© si la date d'aujourd'hui est comprise entre le 1er janvier 2019 et le 30 juin 2020.
- Il faut que le client ait :
  - soit 40 ans
  - soit qu'il ait entre 15 et 30 ans et que la tempÃ©rature extÃ©rieure soit supÃ©rieure Ã  15 Â°C avec un soleil radieux.
- Si le client valide ces restrictions, alors il obtient une rÃ©duction de 20 % sur son trajet.

### Ajout d'un promocode

ğŸ‘‰ Le service doit exposer une route pour ajouter un promocode.

> â„¹ï¸ Pour la persistance des donnÃ©es, une implÃ©mentation basique en mÃ©moire est suffisante.
> Pas besoin dâ€™avoir une vraie base de donnÃ©es.

_Exemple de requÃªte :_

```json
{
  "name": "WeatherCode",
  "advantage": { "percent": 20 },
  "restrictions": [
    {
      "date": {
        "after": "2019-01-01",
        "before": "2020-06-30"
      }
    },
    {
      "or": [
        {
          "age": {
            "eq": 40
          }
        },
        {
          "and": [
            {
              "age": {
                "lt": 30,
                "gt": 15
              }
            },
            {
              "weather": {
                "is": "clear",
                "temp": {
                  "gt": 15 // Celsius here.
                }
              }
            }
          ]
        }
      ]
    }
  ]
}
```

### **Validation d'un** _promocode_

ğŸ‘‰ Le service doit exposer une route pour valider l'utilisation d'un promocode pour un utilisateur donnÃ©.

- En cas de promocode valide, le service retourne la rÃ©duction associÃ©e
- En cas de promocode invalide, le service retourne la liste des raisons pour lesquelles le promocode est invalide

> â„¹ï¸ La mÃ©tÃ©o de la ville est Ã  rÃ©cupÃ©rer via un service externe. Voir [**MÃ©tÃ©o**](https://www.notion.so/M-t-o-be9fa06ce0334037b1d8f84fdf3a7d1a?pvs=21)

_Exemple de requÃªte :_

```json
{
  "promocode_name": "WeatherCode",
  "arguments": {
    "age": 25,
    "town": "Lyon"
  }
}
```

_Exemple de rÃ©ponse si le promocode est validÃ© :_

```json
{
  "promocode_name": "WeatherCode",
  "status": "accepted",
  "advantage": { "percent": 20 }
}
```

_Exemple de rÃ©ponse si le promocode est invalidÃ© :_

```json
{
  "promocode_name": "WeatherCode",
  "status": "denied",
  "reasons": [
    // Les raisons pour lesquelles le promocode n'a pas Ã©tÃ© validÃ©
  ]
}
```

## **Ã‰valuation**

ğŸ¯ Lâ€™objectif de cet exercice est dâ€™avoir un aperÃ§u de comment tu abordes un problÃ¨me et comment tu codes la solution.
Fais en sorte dâ€™avoir un code qui respecte tes standards de qualitÃ© comme sâ€™il devait aller en production et Ãªtre maintenu dans le futur.

Concentre toi sur :

- Le fonctionnement de lâ€™algorithme
- La lisibilitÃ© et la clartÃ© du code
- Lâ€™architecture de lâ€™application
- Lâ€™appel Ã  lâ€™API pour rÃ©cupÃ©rer la mÃ©tÃ©o
- Les tests automatisÃ©s

Pour nous aider, pense Ã  Ã©crire un README pour expliquer :

- Comment lancer lâ€™application
- Ton algorithme
- Tes choix techniques
- Les pistes dâ€™amÃ©lioration de ton code

âš ï¸ Si tu as envie dâ€™en faire plus, sois dâ€™abord certain dâ€™avoir bien rÃ©pondu aux attentes prÃ©cÃ©dentes.

Les Ã©lÃ©ments suivants sont des nice to have mais **nâ€™interviennent pas dans notre Ã©valuation** de cet exercice (liste non exhaustive) :

- Docker ou autre conteneurisation
- CI (continuous integration)
- Base de donnÃ©es (SQL, NoSQL, â€¦)
- Swagger, Postman ou autre documentation dâ€™API
- Authentification
- HÃ©bergement dans le cloud
- â€¦
